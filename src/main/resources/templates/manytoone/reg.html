<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Insert title here</title>
    <!-- include libraries(jQuery, bootstrap) -->
	<link href="https://stackpath.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css" rel="stylesheet">
	<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
	<script src="https://stackpath.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
	
	<!-- include summernote css/js -->
	<link href="https://cdn.jsdelivr.net/npm/summernote@0.8.18/dist/summernote.min.css" rel="stylesheet">
	<script src="https://cdn.jsdelivr.net/npm/summernote@0.8.18/dist/summernote.min.js"></script>
	<script type="text/javascript">
		$(function(){
			$('#summernote').summernote();
		});
		function imgSizeCheck(file){
			var fileInfo=$(file)[0].files[0];
			
			console.log("inx:"+fileInfo.type.indexOf("image"));
			if(fileInfo.type.indexOf("image")!=0){
				alert("이미지 파일이 아닙니다.")
				$(file).val("");
				return;
			}
			console.log("size:"+(fileInfo.size));
			if(fileInfo.size > (1024*1024*2)){
				alert("파일의 용량이 2MB미만 이미지만 허용합니다. : " + fileInfo.size);
				$(file).val("");
				return;
			}
			
			//이미지 임시로딩
		
			var formData = new FormData();
			formData.append("img", $(file)[0].files[0]);
			//비동기 서버요청
			$.ajax({
				url:"/img-temploading",
				type: "post",
				contentType: false,
				processData: false,
				data: formData,
				success:function(url){
					console.log("temp:"+url);
					$(file).siblings(".pre-img").css("background-image","url("+url+")");
				}
			});
			
		}
		
	</script>
	<style type="text/css">
		.pre-img{
			display: block;
			width: 100px;
			height: 100px;
			background-repeat: no-repeat;
			background-size: contain;
			background-position: center;
		}
	</style>
</head>
<body>
    
    <p>상품등록페이지</p>
    
    <form action="/manytoone" method="post" enctype="multipart/form-data" >
    	
    	<p>
    		<input type="text" name="title" placeholder="상품명">
    	</p>
    	<p>
    		<!-- Multipart img 객체에서처리 -->
    		<label class="pre-img"></label>
    		<input type="file" name="img" placeholder="상품이미지" onchange="imgSizeCheck(this)">
    		
    	</p>
    	<p>
    		<input type="text" name="price" placeholder="가격">
    	</p>
    	<p>
    		<input type="number" name="stock" placeholder="재고">
    	</p>
    	<p>
    		<textarea id="summernote" name="content"></textarea>
    	</p>
    	<p>
    		<button>등록</button>
    	</p>
    </form>
</body>
</html>